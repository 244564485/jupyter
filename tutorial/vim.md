# vi/vim命令大全


系统时间(在光标之后追加当前的日期和时间) :  map <F7> a<C-R>=strftime("%c")<CR><esc>
系统时间(将__date__替换成当前日期, 使用strftime函数):s/__date__/\=strftime("%c")/

## 基础命令
ctrl+q              可以联合复制, 粘贴, 替换用 行操作
ctrl+w+j ctrl+w+k (:bn :bp :bd)
'.                  它移动光标到上一次的修改行  
`.                  它移动光标到上一次的修改点
  .                   重复上次命令
   <C-O> :             依次沿着你的跳转记录向回跳 (从最近的一次开始)
 <C-I> :             依次沿着你的跳转记录向前跳
ju(mps) :           列出你跳转的足迹
:history :          列出历史命令记录
:his c :            命令行命令历史
:his s :            搜索命令历史
q/ :                搜索命令历史的窗口
q: :                命令行命令历史的窗口
g ctrl+g            计算文件字符
{,}                 前进至上一段落前进至后一段落
gg,G(2G)            文件首
gd dw gf ga(进制转化)
gg=G 全篇自动缩进 , =G 单行缩进
* ci[ 删除一对 [] 中的所有字符并进入插入模式
* ci( 删除一对 () 中的所有字符并进入插入模式
* ci< 删除一对 <> 中的所有字符并进入插入模式
* ci{ 删除一对 {} 中的所有字符并进入插入模式
* cit 删除一对 HTML/XML 的标签内部的所有字符并进入插入模式
* ci" ci' ci` 删除一对引号字符 (" 或 ' 或 `) 中所有字符并进入插入模式
* vi[ 选择一对 [] 中的所有字符
* vi( 选择一对 () 中的所有字符
* vi< 选择一对 <> 中的所有字符
* vi{ 选择一对 {} 中的所有字符
* vit 选择一对 HTML/XML 的标签内部的所有字符
* vi" vi' vi` 选择一对引号字符 (" 或 ' 或 `) 中所有字符
crl+] 函数原型处 crl+t 回 ( ctags )
ctl+p 自动补全( 编辑状态 )
:X 加密保存( 要输入密码 )
? /         (N n)
f(F,t) 查找字符
 w(e) 移动光标到下一个单词.
5fx 表示查找光标后第 5 个 x 字符.
5w(e) 移动光标到下五个单词.
b 移动光标到上一个单词.
0 移动光标到本行最开头.
^ 移动光标到本行最开头的字符处.
$ 移动光标到本行结尾处.
H 移动光标到屏幕的首行. 
M 移动光标到屏幕的中间一行.
L 移动光标到屏幕的尾行.
  c-f (即 ctrl 键与 f 键一同按下)
c-b (即 ctrl 键与 b 键一同按下) 翻页
c-d (下半页) c-u(上半页) c-e (一行滚动)
zz 让光标所在的行居屏幕中央
zt 让光标所在的行居屏幕最上一行
zb 让光标所在的行居屏幕最下一行
在 vi 中 y 表示拷贝, d 表示删除, p 表示粘贴. 其中拷贝与删除是与光标移动命令
yw 表示拷贝从当前光标到光标所在单词结尾的内容.
 dw 表示删除从当前光标到光标所在单词结尾的内容.
y0 表示拷贝从当前光标到光标所在行首的内容.
d0 表示删除从当前光标到光标所在行首的内容.
y$(Y) 表示拷贝从当前光标到光标所在行尾的内容.
d$(D) 表示删除从当前光标到光标所在行尾的内容.
yfa 表示拷贝从当前光标到光标后面的第一个a字符之间的内容.
dfa 表示删除从当前光标到光标后面的第一个a字符之间的内容.
s(S),a(A),x(X),D
yy 表示拷贝光标所在行.
dd 表示删除光标所在行.
5yy 表示拷贝光标以下 5 行.
5dd 表示删除光标以下 5 行.
y2fa 表示拷贝从当前光标到光标后面的第二个a字符之间的内容.
:12,24y 表示拷贝第12行到第24行之间的内容.
:12,y 表示拷贝第12行到光标所在行之间的内容.
:,24y 表示拷贝光标所在行到第24行之间的内容. 删除类似.
TAB 就是制表符, 单独拿出来做一节是因为这个东西确实很有用.
 << 输入此命令则光标所在行向左移动一个 tab.
>> 输入此命令则光标所在行向右移动一个 tab.
5>> 输入此命令则光标后 5 行向右移动一个 tab.
 :5>>(>>>) :>>(>>>)5
:12,24> 此命令将12行到14行的数据都向右移动一个 tab.
:12,24>> 此命令将12行到14行的数据都向右移动两个 tab.
:set shiftwidth=4 设置自动缩进 4 个空格, 当然要设自动缩进先.
:set sts=4 即设置 softtabstop 为 4. 输入 tab 后就跳了 4 格.
:set tabstop=4 实际的 tab 即为 4 个空格, 而不是缺省的 8 个.
:set expandtab 在输入 tab 后, vim 用恰当的空格来填充这个 tab.
:g/^/exec 's/^/'.strpart(line('.').' ', 0, 4) 在行首插入行号
 set ai 设置自动缩进
5ia<esc> 重复插入5个a字符
  替换命令
 替换文字 2009-02-34 ----> 2009-02-34 00:00:00      :%s/\(\d\{4\}-\d\{2\}-\d\{2\}\)/\1 00:00:00/g
:%s/^/heaser/     在每一行头部添加header
:%s/$/ender/     在每一行尾部添加ender
:s/aa/bb/g              将光标所在行出现的所有包含 aa 的字符串中的 aa 替换为 bb
:s/\/bb/g               将光标所在行出现的所有 aa 替换为 bb, 仅替换 aa 这个单词
:%s/aa/bb/g             将文档中出现的所有包含 aa 的字符串中的 aa 替换为 bb
:12,23s/aa/bb/g         将从12行到23行中出现的所有包含 aa 的字符串中的 aa 替换为 bb
:12,23s/^/#/            将从12行到23行的行首加入 # 字符
:%s/fred/joe/igc            一个常见的替换命令, 修饰符igc和perl中一样意思
s/dick/joe/igc则        对于这些满足条件的行进行替换
:g/^\s*$/d              空行(空格也不包含)删除.
:%s/\r//g               删除DOS方式的回车^M
:%s/ *$//               删除行尾空白(%s/\s*$//g)
:g!/^dd/d               删除不含字符串'dd'开头的行
:v/^dd/d                同上,译释:v == g!, 就是不匹配!
:v/./.,/./-1join        压缩空行(多行空行合并为一行)
:g/^$/,/./-j            压缩空行(多行空行合并为一行)
:g/^/pu _               把文中空行扩增一倍 (pu = put),原来两行间有一个空行, 现在变成2个
 :g/^/m0                 按行翻转文章 (m = move)
:g/fred/,/joe/d         not line based (very powerfull)
:g/<input\|<form/p      或者 要用\|
:g/fred/t$              拷贝行, 从fred到文件末尾(EOF)
:%norm jdd              隔行删除,
译释:%指明是对所有行进行操作,norm指出后面是normal模式的指令,j是下移一行, dd是删除行
 :'a,'bg/fred/s/dick/joe/igc   ('a,'b指定一个范围:mark a ~ mark b)
g//用一个正则表达式指出了进行操作的行必须可以被fred匹配,g//是一个全局显示命令
 /joe/e                  光标停留在匹配单词最后一个字母处
/joe/e+1                光标停留在匹配单词最后一个字母的下一个字母处
/joe/s                  光标停留在匹配单词第一个字母处
/^joe.*fred.*bill/      标准正则表达式
/^[A-J]\+/              找一个以A~J中一个字母重复两次或以上开头的行
/forum\(\_.\)*pent      多行匹配
/fred\_s*joe/i          中间可以有任何空白, 包括换行符\n
/fred\|joe              匹配FRED或JOE
/\<fred\>/i             匹配fred,fred必须是一个独立的单词, 而不是子串
/\<\d\d\d\d\>           匹配4个数字 \<\d\{4}\>   列, 
替换所有在第三列中的str1     :%s:\(\(\w\+\s\+\)\{2}\)str1:\1str2:
  交换第一列和最后一列 (共4列)    :%s:\(\w\+\)\(.*\s\+\)\(\w\+\)$:\3\2\1:
全局(global)显示命令, 就是用 :g＋正则表达式
译释: :g/{pattern}/{cmd} 就是全局找到匹配的,然后对这些行执行命令{cmd}
:g/\<fred\>/                                显示所有能够为单词fred所匹配的行
 :g/<pattern>/z#.5                           显示内容, 还有行号
:g/<pattern>/z#.5|echo '=========='         漂亮的显示


## 多文档操作 (基础)
 用 :ls! 可以显示出当前所有的buffer
:bn                 跳转到下一个buffer
:bp                 跳转到上一个buffer
:wn                 存盘当前文件并跳转到下一个
:wp                 存盘当前文件并跳转到上一个
:bd                 把这个文件从buffer列表中做掉
:b 3                跳到第3个buffer
:b main             跳到一个名字中包含main的buffer
列复制
译注:@#%&^#*^%#$!
:%s= [^ ]\+$=&&= : 复制最后一列
 :%s= \f\+$=&&= : 一样的功能
:%s= \S\+$=&& : ft,还是一样反向引用, 或称记忆
:s/\(.*\):\(.*\)/\2 : \1/ : 颠倒用:分割的两个字段
:%s/^\(.*\)\n\1/\1$/ : 删除重复行
非贪婪匹配, \{-}
:%s/^.\{-}pdf/new.pdf/ : 只是删除第一个pdf 跨越可能的多行
 :%s/<!--\_.\{-}-->// : 又是删除多行注释(咦?为什么要说「又」呢?)
:help /\{-} : 看看关于 非贪婪数量符 的帮助
:s/fred/<c-r>a/g : 替换fred成register a中的内容, 呵呵, 
写在一行里的复杂命令   :%s/\f\+\.gif\>/\r&\r/g | v/\.gif$/d | %s/gif/jpg/
译注:就是用 | 管道啦
大小写转换
g~~ : 行翻转
vEU : 字大写(广义字)
vE~ : 字翻转(广义字)
 ~   将光标下的字母改变大小写
 3~  将下3个字母改变其大小写
 g~w 字翻转
 U   将可视模式下的字母全改成大写字母
gUU 将当前行的字母改成大写
 u   将可视模式下的字母全改成小写
 guu 将当前行的字母全改成小写
gUw 将光标下的单词改成大写
guw 将光标下的单词改成小写. 

文件浏览
 :Ex : 开启目录浏览器, 注意首字母E是大写的
:Sex : 在一个分割的窗口中开启目录浏览器
:ls : 显示当前buffer的情况
:cd .. : 进入父目录
 :pwd
:args : 显示目前打开的文件
:lcd %:p:h : 更改到当前文件所在的目录
译释:lcd是仅仅改变当前窗口的工作路径, % 是代表当前文件的文件名, 加上 :p扩展成全名(就是带了路径), 加上 :h析取出路径 



## 常用

中文乱码：export LANG=zh_CN.gbk


字体设置    Linux/Unix: set guifont=Monospace\\空格14 注意这里需要对空格使用\进行转意
   			 Windows: set guifont=Monospace:h14 注意这里的字体大小需要有h的标识


Tab4个字符 ：set ts=4 
正常的行号（:set number :set nu）
让VIM显示相对行号
VIM中可以让行号以相对的方式显示。什么是相对行号？光表示所在行的行号为0，其它行的行号都是相对于这一行增长。
:set relativenumber
设置相对行号
:set norelativenumber
取消相对行号

vim跳转到指定行
在vim中有3中方法可以跳转到指定行（首先按esc进入命令行模式）：
1、ngg/nG （跳转到文件第n行，无需回车）
2、:n （跳转到文件第n行，需要回车）
3、vim +n filename （在打开文件后，跳转到文件的第n行）
命令行模式下输入（n为指定的行号）：
（1）ngg / nG
（2）:n
（3）vim +n filename（注意这里要输入 + 号）
三者的区别在于，ngg/nG输入以后不需要按下回车键，而输入:n之后还要按下回车键才会跳转，vim +n filename只能在打开文件时跳转到相应的行。
比如想跳转到文本的第12行，可以执行如下命令：
（1）12gg / 12G
（2）:12
（3）打开文件时输入vim +12 filename
文本中想查看当前行信息，可输入： Ctrl + g

## vim 打开多个文件
一、如果在终端还没有打开vim
1、vim横向分屏打开多个文件
vim -o 文件1 文件2
2、vim纵向分屏打开多个文件
vim -O 文件1 文件2
二、如果在终端已经打开vim
1、横向分屏打开另一个文件
:vs 文件
2、纵向分屏打开另一个文件
:sp 文件
三、关闭窗口
1、关闭所有
:qa
2、关闭光标所在窗口
:q或者:close
3、关闭除光标所在的窗口之外的其它窗口
:only
四、切换窗口
ctrl + w w(w按两次)
或者 
ctrl + hjkl

## vim中翻页的命令

整页翻页 ctrl-f ctrl-b
f就是forword b就是backward

翻半页
ctrl-d ctlr-u
d=down u=up

滚一行
ctrl-e ctrl-y

zz 让光标所杂的行居屏幕中央
zt 让光标所杂的行居屏幕最上一行 t=top
zb 让光标所杂的行居屏幕最下一行 b=bottom



(命令模式)冒号+指令
在vim命令模式界面想要退出，需要输入冒号和指令
:wq   保存并退出
:q  维修改退出
:q! 强制退出并不保存
(命令模式)移动光标
在vim界面，命令模式下光标移动方法
1、使用上下左右方向键
2、命令模式下：
h   向左
j   向下 
k   向上
l  向右
空格键 向右
Backspace  向左

    e 转到下一个单词的结尾 g e 
    w 转到下一个单词的开头
    b 转到前一个单词的开头



Enter  移动到下一行首
-  移动到上一行首。
:set  nu     //显示行号
:set nonu    //取消显示行号
n+        //向下跳n行
n-         //向上跳n行
nG        //跳到行号为n的行
G           //跳至文件的底部
g         //跳转到文件头部
(插入模式)编辑模式
以下按键进入编辑插入模式
a      //在当前光标位置的右边添加文本
i       //在当前光标位置的左边添加文本
A     //在当前行的末尾位置添加文本
I      //在当前行的开始处添加文本(非空字符的行首)
O     //在当前行的上面新建一行
o     //在当前行的下面新建一行
R    //替换(覆盖)当前光标位置及后面的若干文本
J    //合并光标所在行及下一行为一行(依然在命令模式)
ESC可以退出编辑模式
(命令模式)删除和复制
在vim中, 除了在编辑模式下修改文件，命令模式的时候可以删除和复制
x         //删除当前字符
nx         //删除从光标开始的n个字符
dd       //删除当前行
ndd      //向下删除当前行在内的n行
u        //撤销上一步操作
U        //撤销对当前行的所有操作
yy       //将当前行复制到缓存区，也可以用 "ayy 复制，"a 为缓冲区，a也可以替换为a到z的任意字母，可以完成多个复制任务。
nyy      //将当前行向下n行复制到缓冲区，也可以用 "anyy 复制，"a 为缓冲区，a也可以替换为a到z的任意字母，可以完成多个复制任务。
yw       //复制从光标开始到词尾的字符。
nyw      //复制从光标开始的n个单词。
y^       //复制从光标到行首的内容。  VPS侦探
y$       //复制从光标到行尾的内容。
p        //粘贴剪切板里的内容在光标后，如果使用了前面的自定义缓冲区，建议使用"ap 进行粘贴p。
P        //粘贴剪切板里的内容在光标前，如果使用了前面的自定义缓冲区，建议使用"aP 进行粘贴P。

(命令模式)搜索和替换
命令模式下(esc退出插入模式)
/keyword     //向光标下搜索keyword字符串，keyword可以是正则表达式
?keyword     //向光标上搜索keyword字符串
n           //向下搜索前一个搜素动作
N         //向上搜索前一个搜索动作
*(#)      //当光标停留在某个单词上时, 输入这条命令表示查找与该单词匹配的下(上)一个单词. 同样, 再输入 n 查找下一个匹配处, 输入 N 反方向查找.
g*(g#)        //此命令与上条命令相似, 只不过它不完全匹配光标所在处的单词, 而是匹配包含该单词的所有字符串.
:s/old/new      //用new替换行中首次出现的old
:s/old/new/g         //用new替换行中所有的old
:n,m s/old/new/g     //用new替换从n到m行里所有的old
:%s/old/new/g      //用new替换当前文件里所有的old


## 查找字符串

一，全匹配：
1，从上往下查找，比如“string” ：   /string
2，从下往上查找，比如“string” ： ?string 
二，模糊匹配（正则表达式）
1，. ：通配1个字符 ，如 匹配 server, 可以用  /se...r
2，* ：通配多个字符，如 匹配 privilege，可以用 p*ge
三，快速查找
1， Shift + * ：让光标停留在想要查找的单词的任意一个字母上面， 然后输入 Shift + * ，即可快速选中该单词，并且通过 n  或  N 进行上一个或下一个的匹配。
2，yw ：让光标停留在单词的第一个字母上， 然后输入yw拷贝该单词， 然后输入 / (Ctrl + R) 0 （即 /”0），回车， 就查找到了第一个匹配的单词， 并且通过 n  或  N 进行上一个或下一个的匹配。


## 在vim中的查找和替换
1，查找
在normal模式下按下/即可进入查找模式，输入要查找的字符串并按下回车。 Vim会跳转到第一个匹配。按下n查找下一个，按下N查找上一个。
Vim查找支持正则表达式，例如/vim$匹配行尾的"vim"。 需要查找特殊字符需要转义，例如/vim\$匹配"vim$"。
2，大小写敏感查找
在查找模式中加入\c表示大小写不敏感查找，\C表示大小写敏感查找。例如：
/foo\c
将会查找所有的"foo","FOO","Foo"等字符串。
3，大小写敏感配置
Vim 默认采用大小写敏感的查找，为了方便我们常常将其配置为大小写不敏感：
" 设置默认进行大小写不敏感查找
set ignorecase
" 如果有一个大写字母，则切换到大小写敏感查找
set smartcase 
将上述设置粘贴到你的~/.vimrc，重新打开Vim即可生效
4，查找当前单词
在normal模式下按下*即可查找光标所在单词（word）， 要求每次出现的前后为空白字符或标点符号。例如当前为foo， 可以匹配foo bar中的foo，但不可匹配foobar中的foo。 这在查找函数名、变量名时非常有用。
按下g*即可查找光标所在单词的字符序列，每次出现前后字符无要求。 即foo bar和foobar中的foo均可被匹配到。
5，查找与替换
:s（substitute）命令用来查找和替换字符串。语法如下：
:{作用范围}s/{目标}/{替换}/{替换标志}
例如:%s/foo/bar/g会在全局范围(%)查找foo并替换为bar，所有出现都会被替换（g）
6，作用范围
作用范围分为当前行、全文、选区等等。
当前行：
:s/foo/bar/g
全文：
:%s/foo/bar/g
选区，在Visual模式下选择区域后输入:，Vim即可自动补全为 :'<,'>。
:'<,'>s/foo/bar/g
2-11行：
:5,12s/foo/bar/g
当前行.与接下来两行+2：
:.,+2s/foo/bar/g
替换标志
上文中命令结尾的g即是替换标志之一，表示全局global替换（即替换目标的所有出现）。 还有很多其他有用的替换标志：
空替换标志表示只替换从光标位置开始，目标的第一次出现：
:%s/foo/bar
i表示大小写不敏感查找，I表示大小写敏感：
:%s/foo/bar/i
# 等效于模式中的\c（不敏感）或\C（敏感）
:%s/foo\c/bar
c表示需要确认，例如全局查找"foo"替换为"bar"并且需要确认：
:%s/foo/bar/gc
回车后Vim会将光标移动到每一次"foo"出现的位置，并提示
replace with bar (y/n/a/q/l/^E/^Y)?
按下y表示替换，n表示不替换，a表示替换所有，q表示退出查找模式， l表示替换当前位置并退出。^E与^Y是光标移动快捷键，参考： Vim中如何快速进行光标移
大小写敏感查找
在查找模式中加入\c表示大小写不敏感查找，\C表示大小写敏感查找。例如：
/foo\c
将会查找所有的"foo","FOO","Foo"等字符串。

查找替换
查找和替换是编辑器中最常用的功能之一，在普通编辑器当中查找替换时，你可能需要先移动鼠标在菜单中点击查找的功能，输入查找内容，再点击确认查找。而在vim中，所有的操作只需要敲击几下键盘就行了，手不用离开键盘区域，速度自然会快很多很多。
1、字符的替换及撤销（Undo操作）
替换和撤销(Undo)命令
替换和Undo命令都是针对普通模式下的操作
命令 	说明
r+<待替换字母> 	将游标所在字母替换为指定字母
R 	连续替换，直到按下Esc
cc 	替换整行，即删除游标所在行，并进入插入模式
cw 	替换一个单词，即删除一个单词，并进入插入模式
C(大写) 	替换游标以后至行末
~ 	反转游标所在字母大小写
u{n} 	撤销一次或n次操作
U(大写) 	撤销当前行的所有修改
Ctrl+r 	redo，即撤销undo的操作
打开文件进行编辑：
$ vim practice_2
#输入以下文本
www.shiyanlou.com
然后依次进行如下操作
输入fa 跳转到第一个a字符
输入r，并且输入b，a字符被b字符替换（实用）
输入R替换字符，输入新字符串，输入完按ESC回到普通模式（实用）
输入cc替换整行字符，输入新字符串，输入完按ESC回到普通模式
输入cw 替换一个英文字(word)，输入完按ESC回到普通模式（实用）
输入~，翻转游标所在字符的大小写
输入C 替换至行尾，即游标所在处以后的字都会被替换，输入完按ESC回到普通模式
输入u 撤销上一次的操作

2、快速缩进
使用命令进行快速调整缩进操作
在vim中进行快速缩进，缩进操作均在普通模式下有效打开文件进行编辑
vim protocols
普通模式下输入15G，跳转到15行
普通模式下输入>> 整行将向右缩进（使用，用于格式化代码超爽）
普通模式下输入<< 整行向左回退
普通模式下输入:进入命令行模式下对shiftwidth值进行设置可以控制缩进和回退的字符数
shiftwidth命令
shiftwidth命令是指上一节>>命令产生的缩进（可以简写成sw） 普通模式下输入:进入命令行模式下对shiftwidth值进行设置可以控制缩进和回退的字符数 获取目前的设定值
:set shiftwidth?
设置缩进为10个字符
:set shiftwidth=10
输入 ESC 回到普通模式，再次尝试 >> 看缩进量是否变化
调整文本位置
命令行模式下输入:ce(center)命令使本行内容居中
:ce
命令行模式下输入:ri(right)命令使本行文本靠右
:ri
命令行模式下输入:le(left)命令使本行内容靠左
:le

3、查找
快速查找
普通模式下输入 / 然后键入需要查找的字符串 按回车后就会进行查找。 ？ 与/ 功能相同，只不过 ？ 是向上而 / 是向下查找。 进入查找之后，输入n 和 N 可以继续查找 n表示继续查找，N 反向查找
快速查找练习
使用 vim 打开文件进行编辑（搜索高亮需要在配置文件 .vimrc 中设置 set hls ，实验环境中已经设置好了）
vim protocols
普通模式下输入/icmp然后回车即可查找字符串 icmp
普通模式下输入n查找下一个 icmp
普通模式下输入？tcp向上查找字符串 tcp
普通模式下输入N查找上一个出现的 tcp
命令行模式下输入 noh 然后回车即可取消搜索
高级查找
普通模式下输入\*寻找游标所在处的单词
普通模式下输入\#同上，但 \# 是向前（上）找，\*则是向后（下）找
普通模式下输入g\*同\* ，但部分符合该单词即可
普通模式下输入g\#同\# ，但部分符合该单词即可
以上查找n,N 的继续查找命令依然可以用

## 查找替换 与 正则表达式

查找替换
VIM中常用的替换模式总结。
1，简单替换表达式
替换命令可以在全文中用一个单词替换另一个单词：
:%s/four/4/g
"%" 范围前缀表示在所有行中执行替换。最后的 "g" 标记表示替换行中的所有匹配点。如果仅仅对当前行进行操作，那么只要去掉%即可
如果你有一个象 "thirtyfour" 这样的单词，上面的命令会出错。这种情况下，这个单词会被替换成"thirty4"。要解决这个问题，用 "\<" 来指定匹配单词开头：
:%s/\<four/4/g
显然，这样在处理 "fourty" 的时候还是会出错。用 "\>" 来解决这个问题：
:%s/\<four\>/4/g
如果你在编码，你可能只想替换注释中的 "four"，而保留代码中的。由于这很难指定，可以在替换命令中加一个 "c" 标记，这样，Vim 会在每次替换前提示你：
:%s/\<four\>/4/gc
2，删除多余的空格
要删除这些每行后面多余的空格，可以执行如下命令：
:%s/\s\+$//
命令前面指明范围是 "%"，所以这会作用于整个文件。"substitute" 命令的匹配模式是
"\s\+$"。这表示行末（$）前的一个或者多个（\+）空格（\s）。替换命令的 "to" 部分是空的："//"。这样就会删除那些匹配的空白字符。
3，匹配重复性模式
星号项 "*" 规定在它前面的项可以重复任意次。因此:
/a*
匹配 "a"，"aa"，"aaa"，等等。但也匹配 "" (空字串)，因为零次也包含在内。星号 "*" 仅仅应用于那个紧邻在它前面的项。因此 "ab*" 匹配 "a"，"ab"，"abb","abbb"，等等。如要多次重复整个字符串，那么该字符串必须被组成一个项。组成一项的方法就是在它前面加 "\("，后面加 "\)"。因此这个命令:
/\(ab\)*
匹配: "ab"，"abab"，"ababab"，等等。而且也匹配 ""。
要避免匹配空字串，使用 "\+"。这表示前面一项可以被匹配一次或多次。
/ab\+
匹配 "ab"，"abb"，"abbb"，等等。它不匹配 后面没有跟随 "b" 的 "a"。
要匹配一个可选项，用 "\="。 例如:
/folders\=
匹配 "folder" 和 "folders"。
4，指定重复次数
要匹配某一项的特定次数重复，使用 "\{n,m}" 这样的形式。其中 "n" 和 "m" 都是数字。在它前面的那个项将被重复 "n" 到 "m" 次 (|inclusive| 包含 "n" 和 "m")。例如:
/ab\{3,5}
匹配 "abbb"，"abbbb" 以及 "abbbbb"。
当 "n" 省略时，被默认为零。当 "m" 省略时，被默认为无限大。当 ",m" 省略时，就表示重复正好 "n" 次。例如:
模式          匹配次数
\{,4}          0，1，2，3 或 4
\{3,}          3，4，5，等等
\{0,1}          0 或 1，同 \=
\{0,}          0 或 更多，同 *
\{1,}          1 或 更多，同 \+
\{3}            3
5，多选一匹配
在一个查找模式中，"或" 运算符是 "\|"。例如:
/foo\|bar
这个命令匹配了 "foo" 或 "bar"。更多的抉择可以连在后面:
/one\|two\|three
匹配 "one"，"two" 或 "three"。
如要匹配其多次重复，那么整个抉择结构须置于 "\(" 和 "\)" 之间:
/\(foo\|bar\)\+
这个命令匹配 "foo"，"foobar"，"foofoo"，"barfoobar"，等等。
再举个例子:
/end\(if\|while\|for\)
这个命令匹配 "endif"，"endwhile" 和 "endfor"。
替换
:[range]s/{pattern}/{string}/[flags]
:1,10s/from/to/ 表示在第1到第10行（包含第1，第10行）之间搜索替换
:10s/from/to/ 表示只在第10行搜索替换
:%s/from/to/ 表示在所有行中搜索替换
1,$s/from/to/ 同上
flags 有如下四个选项
c confirm，每次替换前询问；
e error， 不显示错误；
g globle，不询问，整行替换。如果不加g选项，则只替换每行的第一个匹配到的字符串；
i ignore，忽略大小写
这些选项可以合并使用，如cgi表示不区分大小写，整行替换，替换前询问
正则表达式
元字符
. 匹配任意字符
[abc] 匹配方括号中的任意一个字符，可用-表示字符范围。如[a-z0-9]匹配小写字母和数字
[^abc] 匹配除方括号中字符之外的任意字符
\d 匹配阿拉伯数字，等同于[0-9]
\D 匹配阿拉伯数字之外的任意字符，等同于[^0-9]
\x 匹配十六进制数字，等同于[0-9A-Fa-f]
\X 匹配十六进制数字之外的任意字符，等同于[^0-9A-Fa-f]
\l 匹配[a-z]
\L 匹配[^a-z]
\u 匹配[A-Z]
\U 匹配[^A-Z]
\w 匹配单词字母，等同于[0-9A-Za-z_]
\W 匹配单词字母之外的任意字符，等同于[^0-9A-Za-z_]
\t 匹配<TAB>字符
\s 匹配空白字符，等同于[\t]
\S 匹配非空白字符，等同于[^\t]
一些普通字符需转意
\* 匹配* 字符
.  匹配. 字符
\/ 匹配 / 字符
\  匹配 \ 字符
\[ 匹配 [ 字符
\] 匹配 ] 字符
表示数量的元字符
*  匹配0-任意个
\+ 匹配1-任意个
\? 匹配0-1个
\{n,m} 匹配n-m个
\{n}  匹配n个
\{n,}  匹配n-任意个
\{,m}  匹配0-m个
表示位置的元字符
$  匹配行尾
^  匹配行首
\< 匹配单词词首
\> 匹配单词词尾
替换变量
在正则式中以\(和\)括起来的正则表达式，在后面使用的时候可以用\1、\2等变量来访问\(和\)中的内容1
例子
删除行尾空格：:%s/\s+$//g
删除行首多余空格：%s/^\s*// 或者 %s/^ *//
删除沒有內容的空行：%s/^$// 或者 g/^$/d
删除包含有空格组成的空行：%s/^\s*$// 或者 g/^\s*$/d
删除以空格或TAB开头到结尾的空行：%s/^[ |\t]*$// 或者 g/^[ |\t]*$/d
把文中的所有字符串“abc……xyz”替换为“xyz……abc”可以有下列写法
查找替换归纳总结
简单替换表达式
替换命令可以在全文中用一个单词替换另一个单词：
:%s/four/4/g
"%" 范围前缀表示在所有行中执行替换。最后的 "g" 标记表示替换行中的所有匹配点。如果仅仅对当前行进行操作，那么只要去掉%即可
如果你有一个象 "thirtyfour" 这样的单词，上面的命令会出错。这种情况下，这个单词会被替换成"thirty4"。要解决这个问题，用 "\<" 来指定匹配单词开头：
:%s/\<four/4/g
显然，这样在处理 "fourty" 的时候还是会出错。用 "\>" 来解决这个问题：
:%s/\<four\>/4/g
如果你在编码，你可能只想替换注释中的 "four"，而保留代码中的。由于这很难指定，可以在替换命令中加一个 "c" 标记，这样，Vim 会在每次替换前提示你：
:%s/\<four\>/4/gc
删除多余的空格
要删除这些每行后面多余的空格，可以执行如下命令：
:%s/\s\+$//
命令前面指明范围是 "%"，所以这会作用于整个文件。"substitute" 命令的匹配模式是
"\s\+$"。这表示行末（$）前的一个或者多个（\+）空格（\s）。替换命令的 "to" 部分是空的："//"。这样就会删除那些匹配的空白字符。
匹配重复性模式
星号项 "*" 规定在它前面的项可以重复任意次。因此:
/a*
匹配 "a"，"aa"，"aaa"，等等。但也匹配 "" (空字串)，因为零次也包含在内。星号 "*" 仅仅应用于那个紧邻在它前面的项。因此 "ab*" 匹配 "a"，"ab"，"abb","abbb"，等等。如要多次重复整个字符串，那么该字符串必须被组成一个项。组成一项的方法就是在它前面加 "\("，后面加 "\)"。因此这个命令:
/\(ab\)*
匹配: "ab"，"abab"，"ababab"，等等。而且也匹配 ""。
要避免匹配空字串，使用 "\+"。这表示前面一项可以被匹配一次或多次。
/ab\+
匹配 "ab"，"abb"，"abbb"，等等。它不匹配 后面没有跟随 "b" 的 "a"。
要匹配一个可选项，用 "\="。 例如:
/folders\=
匹配 "folder" 和 "folders"。
指定重复次数
要匹配某一项的特定次数重复，使用 "\{n,m}" 这样的形式。其中 "n" 和 "m" 都是数字。在它前面的那个项将被重复 "n" 到 "m" 次 (|inclusive| 包含 "n" 和 "m")。例如:
/ab\{3,5}
匹配 "abbb"，"abbbb" 以及 "abbbbb"。
当 "n" 省略时，被默认为零。当 "m" 省略时，被默认为无限大。当 ",m" 省略时，就表示重复正好 "n" 次。例如:
模式          匹配次数
\{,4}          0，1，2，3 或 4
\{3,}          3，4，5，等等
\{0,1}          0 或 1，同 \=
\{0,}          0 或 更多，同 *
\{1,}          1 或 更多，同 \+
\{3}            3
多选一匹配
在一个查找模式中，"或" 运算符是 "\|"。例如:
/foo\|bar
这个命令匹配了 "foo" 或 "bar"。更多的抉择可以连在后面:
/one\|two\|three
匹配 "one"，"two" 或 "three"。
如要匹配其多次重复，那么整个抉择结构须置于 "\(" 和 "\)" 之间:
/\(foo\|bar\)\+
这个命令匹配 "foo"，"foobar"，"foofoo"，"barfoobar"，等等。
再举个例子:
/end\(if\|while\|for\)
这个命令匹配 "endif"，"endwhile" 和 "endfor"。

编辑文本

编辑文本： vi（默认）、vim + 文件名
三大模式切换（命令模式，（插入）编辑模式，（末行）底行模式）
i 切换到输入模式，以输入字符
: 切换到底线命令模式，以在最底一行输入命令。
命令模式
复制一行：yy
粘贴 ： p 光标所在行下一行
P 光标所在行上一行
撤销（后退） ： u 取消撤销：ctrl+r
前进:ctrl+r
复制多行：3yy (光标所在行开始3行复制)
删除一行：dd
删除多行 ： 2dd （光标行的下一行开始删除）
删除当前光标所在处的字符: x
行间跳转：行首 ctrl+home, gg,1G,
10G(10行)
行末：ctrl+end G
翻页：下一页ctrl+f 上一页：ctrl+b
行内跳转：home，^行首 end $行尾
下一行插入：o
上一行插入：O
当前光标位置的右边添加文本：a
当前光标位置的左边添加文本：i
当前光标所在行的末尾处添加文本：A
当前光标所在行的开始处添加文本：I
（插入）编辑模式
esc 退出输入模式，切换到命令模式
（末行）底行模式
q! 不保存 强制退出 q 退出 w 保存
wq 保存退出
显示行数：set nu(number)
隐藏行数：set nonu()
复制：15,20 co 0
移动剪切：12,17 m 0
另存为：w 文件名
将文档还原成最原始的状态：e!
读取文件内容到当前文本：r 文件名
查找： （从上往下） /查找的词 n 查找下一个 N 查找上一个
（从下往上） ?查询的词 n 查找上一个 N 查找下一个
替换： s/旧词/新词/ 替换一个
s/旧词/新词/g 替换一行
1,3s/旧词/新词/g 替换第一到第三行
%s/旧词/新词/g 替换所有
查看文件内容
head 文件名 显示前10行
head -5 文件名 显示前5行
tail 文件名 显示后10行
more 文件名 自动退出
less 文件名 不退出 q退出
将 动态加载 打印到文件中
ping www.baidu.com >>123.txt & （放到后台运行）
杀死进程 kill -9(强制) pid
模糊查询 ll *abc*
模糊查询进程 ll |（管道符） grep abc
模糊查询ping ps -ef |grep ping
帮助文档 q退出
ls --help
man ls
info ls
查看当前日期 :date
显示日历： cal
计算器：bc (quit退出)
查看内存 ：free
查看硬盘 ：df -h
网络配置
setup
3. cd sysconfig/ network-scripts vim ifcfg


## 批量注释与反注释

在使用vim编写代码的时候，经常需要用到批量注释与反注释一段代码。下面简要介绍其操作。
方法一 块选择模式
插入注释：
用v进入virtual模式
用上下键选中需要注释的行数
按Control+v（win下面ctrl+q）进入列模式
按大些“I”进入插入模式，输入注释符“#”或者是"//"，然后立刻按下ESC（两下）
取消注释：
Ctrl + v 进入块选择模式，选中你要删除的行首的注释符号，注意// 要选中两个，选好之后按d即可删除注释
方法二 替换命令
批量注释：
使用下面命令在指定的行首添加注释：
:起始行号,结束行号s/^/注释符/g
取消注释：
:起始行号,结束行号s/^注释符//g
实例演示：
在27 - 30行添加 // 注释
:27,30s#^#//#g
在27 - 30行删除 // 注释
:27,30s#^//##g
在10 - 20行添加 # 注释
:10,20s/^/#/g
在10 - 20行删除 # 注释
:10,20s/^/#/g
注意例子中正则的分割符使用的是相反的符号，如果匹配// 那么使用 #作分隔符这样不需要对/作转义处理，节省输入次数。



## 比较两个文件的内容

diff更加具体的命令，比如file1, file2

　　>  diff -u file1 file2
　　>  vimdiff file1 file2

 vimdiff 有点类似于  vim -O file1 file2

1. 使用vim的比较模式打开两个文件：
vim -d file1 file2
或
vimdiff file1 file2
2. 如果已经打开了文件file1，再打开另一个文件file2进行比较：
:vert diffsplit file2
如果没有用vert命令，diffsplit则会分上下两个窗口。
3. 如果已经用split方式打开了两个文件file1，file2，又想比较两文件的不同。
分别在两个窗口里面输入命令：
:diffthis
4. 如果更改了某个窗口的内容，vim又没有自动更新diff检查，可以使用如下命令更新：
:diffupdate
5. 定位到不同点：
[c     跳到前一个不同点
]c     跳到后一个不同点
6. 在窗口间跳转：
ctrl-w w    跳到下一个窗口
ctrl-w h    跳到左侧窗口
ctrl-w l    跳到右侧窗口
ctrl-w j    跳到下方的窗口
ctrl-w k    跳到上方的窗口
7. 合并文档：
dp          将差异点的当前文档内容应用到另一文档（diff put）
do          将差异点的另一文档的内容拷贝到当前文档（diff get）
8. 上下文的展开和查看
比较和合并文件的时候经常需要结合上下文来确定最终要采取的操作。Vimdiff 缺省是会把不同之处上下各 6 行的文本都显示出来以供参考。其他的相同的文本行被自动折叠。如果希望修改缺省的上下文行数为3行，可以这样设置：
:set diffopt=context:3
zf   创建折叠（使用数字表示创建有当前行到下多少行的折叠，比如3j就创建包括4行的折叠）
zo   打开折叠(l也可以打开折叠）
zc   关闭当前折叠
zm   关闭所有折叠
zr   打开所有折叠
zE   删除所有折叠
zd   删除当前折叠
za   若当前打开则关闭，若当前关闭则打开
zj   到下一折叠的开始处
zk   到上一折叠的末尾

实用的vim下比较两个文件命令：
1、 vimdiff file1 file2
终端下输入该命令进入vim，垂直分隔窗口进行比较
2、 vimdiff -o file1 file2
水平分隔窗口进行比较
3、 ctrl+w (j,k,h,l)
上下左右切换光标所在的窗口（括号中表示可以是其中之一，按下ctrl+w，放开ctrl再按j,k,h,l）
4、 ctrl+w (J,K,H,L)
上下左右移动光标所在窗口的位置
5、 zo 和 zc
打开折叠区 和 关闭折叠区
6、 ]c 和 [c
将光标移动到下一个不同区 和 上一个不同区
7、 do 和 dp
将光标所在不同区域同步为另一个文件该位置的内容 和 将光标所在不同区域内容同步到另一个文件该位置
8、 :diffu[!]
vim下更新当前比较窗口，比较状态下修改文件后，可调用该命令[中括号不为命令部分，如果加!表示如果外部修改了文件，则重新加载比较]
9、 :diffo[!]
vim下关闭当前窗口比较状态，如果加!则关闭所有窗口的比较状态
10、:diffs file1
vim下加入file1和当前光标所在窗口进行比较，水平分隔窗口
11、:vert diffs file1
vim下加入file1和当前光标所在窗口进行比较，垂直分隔窗口
12、:difft
vim下将光标所在窗口变为比较窗口
其它技巧：
1、 diff -u file1 file2 > file3
终端下输入该命令，可以将file1和file2的比较结果输出到file3中，-u 表示以合并格式比较，-c 为上下文格式，不加为一般格式
参考：vim下 :help diff

vim中执行shell命令形式
第一种 :!command
不退出vim，并执行shell命令command，将命令输出显示在vim的命令区域，不会改变当前编辑的文件的内容。执行:!ls -al命令
特别的可以运行:!bash来启动一个bash shell并执行命令，不需要退出vim。这点在Linux渗透测试的时候很有用，关于日志清除相关的内容，不想说的太明白，自己体会吧。（最后还要删除VIM所产生的日志文件噢，kali里面是.viminfo，在vim中使用rm -rf强制清除）

第二种 :r !command
将shell命令command的结果插入到当前行的下一行。例如:r !date。读取系统时间并插入到当前行的下一行。

第三种 :起始行号,结束行号!command
将起始行号和结束行号指定的范围内的内容让shell命令command处理，并将处理结果替换起始行号和结束行号指定范围中的内容。例如 :1,4 !sort，将第1行到第4行的内容进行排序。如下图所示：
可以只指定起始行，例如:1 !tr [a-z] [A-Z],将第1行的小写字母转为大写字母。如下图所示：
除可以指定行号外，也可以用.表示当前光标所在行。例如：. !tr [a-z] [A-Z]，将当前行的小写转为大写。

第四种 :起始行号,结束行号 w !command
将起始行号和结束行号所指定范围的内容作为命令command的输入，不会改变当前编辑的文件的内容。
例如:1,4 w !sort，将第1行到第4行的内容进行排序，但排序的结果并不会直接输出到当前编辑的文件中，而是显示到vim敲命令的区域。
特殊的可以用下面的命令: 1 w !bash，将会把第1行的内容作为bash命令来执行并显示结果，而且不会改变当前编辑的文件的内容。同样的 : . w !bash将当前行的内容作为bash命令来执行。




