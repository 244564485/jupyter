

国内四大交易所，各有自己的技术公司，并且各自开发了一套系统。
CTP:上海期货交易
易盛：郑州交易所
飞创：大连交易
飞马：中金所
从原理上讲，各个交易所用自己的技术子公司开发的系统是最好的选择，上期所产品用CTP，中金所产品用飞马，大商所产品用飞创，郑商所产品用易盛，但实际用户做期货可能会在各个交易所都有交易。
从程序化接入来说目前CTP做的是最完善的，同时支持四大交易所，并且性能优越，也是程序化接入使用最多的接口。我也是基于CTP接口进行的开发。


# CTP期货量化交易API工作流程概述
## MdApi工作流程
MdApi是CTP的行情接口，主要实现订阅、接收行情的功能。MdApi的工作流程可以概况为以下八步：
第一步，用CreateFtdcMdApi创建CThostFtdcMdApi实例，例如api。
第二步，创建CThostFtdcMdSpi实例，例如spi，用RegisterSpi将spi注册到api中。
第三步，用RegisterFront将行情前置地址注册到api中。
第四步，用Init()初始化api，初始化的过程就是与服务建立连接的过程。
第五步，与服务器成功建立连接时，回调函数OnFrontConnect会收到通知，此时用ReqUserLogin登录账户。
第六步，账户登录成功时，回调函数OnRspUserLogin会收到通知，此时用SubscribeMarketData订阅行情，用SubscribeForQuoteRsp订阅询价。此后，MdApi就可以正常工作了。
第七步，MdApi正常工作时，交易者需要在回调函数OnRtnDepthMarketData/OnRtnForQuoteRsp会收到最新行情通知时进行数据处理或者分发。
第八步，MdApi的本质是个子进程，所以需要调用Join方法，让主进程等待，才能正常运行。如果遇到连接成功后立即触发OnFrontDisconnected，错误代码8193，就可能是没有调用Join方法。
一般情况下，量化交易框架都会对第一至六步，以及第八步的操作进行封装，交易者只需要传递相关参数即可。需要交易者真正关心的是第七步，涉及到数据处理和数据分发。

## TraderApi工作流程
TraderApi是CTP的交易口，主要实现（买卖开平撤）报单及查询的功能。TraderApi的工作流程可以概况为以下十步：
第一步，用CreateFtdcTraderApi创建CThostFtdcTraderApi实例，例如api。
第二步，创建CThostFtdcTraderSpi实例，例如spi，用RegisterSpi将spi注册到api中。
第三步，用SubscribePrivateTopic订阅私有流，用SubscribePublicTopic订阅公有流。
第四步，用RegisterFront将交易前置地址注册到api中。
第五步，用Init()初始化api，初始化的过程就是与服务建立连接的过程。
第六步，与服务器成功建立连接时，回调函数OnFrontConnect会收到通知，此时用ReqUserAuthMethod认证客户端。
第七步，客户端认证成功时，回调函数OnRspUserAuthMethod会收到通知，此时用ReqUserLogin登录账户。
第八步，账户登录成功，回调函数OnRspUserLogin会收到通知，此时标记状态。此后，TraderApi就可以正常工作了。
第九步，TraderApi正常工作时，交易者根据需要用Req开头的请求函数进行（买卖开平撤）报单及查询，对应的以On开头的回调函数会收到结果通知。
第十步，TraderApi的本质也是个子进程，所以也需要调用Join方法，让主进程等待，才能正常运行。
需要注意的是，TraderApi在初始化之前需要订阅公有流和私有流；与服务建立连接之后需要先进行客户端认证，只有认证通过之后才可以登录账户；TraderApi的查询操作是有流量控制的，每秒只能查询1次，1秒内的连续查询不会收到结果通知。

## Api函数命名规则
除了初始化Api环境时用到的函数之外，其他功能函数可以根据前缀分为以下几类：
* Req，执行请求。例如，确认结算单ReqSettlementInfoConfirm，录入报单ReqOrderInsert，录入撤单ReqOrderAction等。
* OnRsp，请求结果的通知。除（买卖开平撤）报单之外的请求，在执行成功之后获得通知，例如确认结算单通知OnRspSettlementInfoConfirm表示已成功确认结算单。（买卖开平撤）报单请求，在该请求通过交易前置时获得通知，此通知仅代表请求被交易前置接受，后续还需要进入交易队列、被执行等过程。例如，录入报单通知OnRspOrderInsert表示请求被前置接受情况。
*OnRtn，（买卖开平撤）报单请求的状态变化通知，或者公有流通知。以报单为例，报单状态每次发生变化，都会在OnRtnOrder中收到通知，当报单成交时，还会在OnRtnTrade中收到通知。OnRtnInstrumentStatus就是公有流通知的例子。
*OnErrRtn，执行错误结果的通知。例如上期所品种今/昨仓不足。未到交易所的错误结果在OnRsp中获得通知，只有到了交易所被执行时的错误，才在OnErrRtn中通知。
*ReqQry，查询请求。例如，查询报单ReqQryOrder，查询成交ReqQryTrade。
*OnRspQry，查询结果的通知。查询结果通知比较简单，一般就是一个查询请求对应一个查询结果。
如果看到这里您仍感到一头雾水，没关系，本文的主要目的是让您对一些概念有个印象。后期我们还会结合AlgoPlus制作相关教程，让大家理解这些过程。另外，在学习、使用CTP的过程中，您如果遇到问题，可以到www.ctp.plus量化研究社区进行提问。


# CTP开发
## 第一部分   C++基础及Linux编程基础
案例一   C++技术学习（磁盘读写、STL、多线程）
案例二   Linux(Ubuntu)编程环境配置、shell学习
案例三   文本编辑器vim的配置和常用操作
案例四   C++编译器g++与调试器gdb的学习

## 第二部分   CTP_API基础操作
案例五   实盘版CTP交易系统架构解析                             
案例六   报单记录和成交记录的获取         
案例七   持仓明细与资金账户信息的获取                   
案例八   持仓信息与合约信息的获取           
案例九   核心操作：开仓、平仓和撤单               
案例十    CTP常见开发错误解析及预防

## 第三部分   CTP平台高级功能开发
案例十一   订阅全市场所有合约行情             
案例十二   多线程实现人机交互功能
案例十三   风控措施和预警功能（自动触发、人工辅助）
案例十四   多账号登录的实现
案例十五   技术指标编写和历史数据维护（tick及各周期K线）
案例十六   创建完善的CTP实盘交易平台（赠送源代码）

## 第四部分   实盘策略开发案例
案例十七     趋势策略开发
案例十八     套利策略开发
案例十九     子账号系统的开发
案例二十     跟单系统的开发（一跟一，一跟多，多跟多，模拟实盘互跟）
案例二十一   高频策略开发（包含两个高频案例）

## 第五部分   前沿技术：打造国际水准的专业交易系统
案例二十二    C/S架构与B/S架构交易系统
案例二十三   快速建立专业量化投资团队的方法（部门构成、人员配置）
案例二十四   建设高频交易平台（硬件设备、软件、托管、FPGA硬件加速器）


# simnow
https://www.simnow.com.cn/product.action

185043 Pai@6

## 环境介绍
BrokerID统一为：9999
第一套（支持上期所期权、能源中心期权、中金所期权）：
    第一组：Trade Front：180.168.146.187:10201，Market Front：180.168.146.187:10211；【电信】（看穿式前置，使用监控中心生产秘钥）
    第二组：Trade Front：180.168.146.187:10202，Market Front：180.168.146.187:10212；【电信】（看穿式前置，使用监控中心生产秘钥）
    第三组：Trade Front：218.202.237.33:10203，Market Front：218.202.237.33:10213；【移动】（看穿式前置，使用监控中心生产秘钥）
    用户注册后，默认的APPID为simnow_client_test，认证码为0000000000000000（16个0），默认不开终端认证，程序化用户可以选择不开终端认证接入。
    交易品种：六所所有期货品种以及上期所、能源中心、中金所所有期权品种。
    账户资金：初始资金两千万，支持入金，每日最多三次。
    交易阶段(服务时间)：与实际生产环境保持一致。
    客户端软件下载：点击下载客户端。
第二套（7*24）：
    交易前置：180.168.146.187:10130，行情前置：180.168.146.187:10131；【7x24】（看穿式前置，使用监控中心生产秘钥）
    第二套环境仅服务于CTP API开发爱好者，仅为用户提供CTP API测试需求，不提供结算等其它服务。
    新注册用户，需要等到第三个交易日才能使用第二套环境。
    账户、钱、仓跟第一套环境上一个交易日保持一致。
    交易阶段(服务时间)：交易日，16:00～次日09:00；非交易日，16:00～次日12:00。
    用户通过SimNow的账户（上一个交易日之前注册的账户都有效）接入环境，建议通过商业终端进行模拟交易的用户使用第一套环境。

## 成交规则
1、期货交易按照交易所公布的买一卖一价对价成交；
2、买入时：如果委托价大于等于卖一价，则成交，成交价为委托价、卖一价、最新价三价取中，如果委托价小于卖一价，不能成交，等待更优的行情才能成交；
3、卖出时：如果委托价小于等于买一价，则成交，成交价为委托价、买一价、最新价三价取中，如果委托价大于买一价，不能成交，等待更优的行情才能成交。

## 清算规则
每日结算的结算价取自真实市场的结算价，在最后交易日时现金交割（以合约当天结算价了结剩余仓位）。

## 交易时间

日盘
交易所	            集合竞价	    连续交易
上海期货交易所	    8:55-9:00	    上午：09:00-10:15 10:30-11:30
上海国际能源交易中心		        下午：13:30-15:00
大连商品交易所		
郑州商品交易所		
广州期货交易所		
中国金融期货交易所	9:25-9:30	     上午：09:30-11:30
		                            下午：13:00-15:15

夜盘
交易所	            品种类别	                              集合竞价	       连续交易
上海期货交易所	     黄金、白银、黄金期权	                    20:55-21:00	    21:00:-次日02:30
	                铜、铝、锌、铅、不锈钢、锡、镍、铜期权、		             21:00:-次日01:00
	                铝期权、锌期权		
	                螺纹钢、热轧卷板、石油沥青、天然橡胶、纸浆、		         21:00-23:00
	                燃料油 、天胶期权		
上海国际能源交易中心  原油、原油期权	                        20:55-21:00	     21:00-2:30
	                低硫燃料油、20号胶		                                   21:00-23:00
	                国际铜		                                              21:00:-次日01:00
郑州商品交易所	       所有期货品种	                            20:55-21:00	    21:00-23:00
大连商品交易所			




